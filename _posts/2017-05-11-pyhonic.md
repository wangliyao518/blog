---
layout: post
title: "Brief python"
description: how to write elegant and authentic python code, we need one minutes to think more
image: 'http://res.cloudinary.com/dm7h7e8xj/image/upload/v1504809708/django_g7djdj.jpg'
category: 'pyhon'
tags:
- python
- pyhonic
twitter_text: how to write pythonic code
introduction: how to write elegant and authentic python code
---



> If there's a downside to elegance, it's that you need a hard job to get it, and you need a good education to appreciate it.(如果说优雅也有缺点的话，那就是你需要艰巨的工作才能得到它，需要良好的教育才能欣赏它。)
> —— Edsger Wybe Dijkstra

## what's pythonic

什么是pythonic，就像什么是地道的汉语一样，切实存在但标准模糊。import this可以看到Tim Peters提出的Python之禅，它提供了指导思想, PEP8给出的不过是编码规范，对于实践pythonic还远远不够。整个python社区都一直有对pythonic的讨论, 本文也就是到处旁征博引, 以此自我学习和方便大家讨论,我们追求的是python的代码更加的地道

Vivamus sagittis lacus vel augue rutrum faucibus dolor auctor. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.Throughout the python community, there has been a discussion of pythonic, and this article is a place where you can learn and talk about it, and we're looking for a more authentic python code.

## traversal

bad code
```python
for i in [0,1,2,3,4,5]:
    printi ** 2

for i in range(6):
    printi ** 2

```
good code, use xrange
```python
for i in xrange(6):
    printi ** 2
```
xrange会返回一个迭代器，用来一次一个值地遍历一个范围。这种方式会比range更省内存。xrange在Python 3中已经改名为range。


bad code
```python
colors = ['red', 'green', 'blue', 'yellow']
for i in range(len(colors)):
    print colors[i]
```

good code
```python
for color in colors:
    print color
```

bad code
```python
colors = ['red', 'green', 'blue', 'yellow']
for i in range(len(colors)-1, -1, -1):
    print colors[i]
```

good code
```python
for color in reversed(colors):
    print color
```

bad code
```python
colors = ['red', 'green', 'blue', 'yellow']
for i inrange(len(colors)):
    print i, '--->',colors[i]
```

good code
```python
for i, color in enumerate(colors):
    print i, '--->',color
```


- traverse two list
bad code 
```python
names= ['raymond','rachel','matthew']
colors= ['red','green','blue','yellow']
n= min(len(names),len(colors))
for i inrange(n):
    print names[i],'--->',colors[i]
for name, color in zip(names, colors):
    print name,'--->',color
```

good code
```python
for name, color in izip(names,colors):
    print name,'--->',color
```

zip在内存中生成一个新的列表，需要更多的内存。izip比zip效率更高。

注意：在Python 3中，izip改名为zip，并替换了原来的zip成为内置函数。


bad code
```python
blocks = []
while True:
    block= f.read(32)
    if block== '':
        break
    blocks.append(block)
      
```

good code
```python
blocks= []
for block in iter(partial(f.read, 32), ''):
    blocks.append(block)
```

iter接受两个参数。第一个是你反复调用的函数，第二个是标记值。

这个例子里不太能看出来方法二的优势，甚至觉得partial让代码可读性更差了。方法二的优势在于iter的返回值是个迭代器，迭代器能用在各种地方，set，sorted，min，max，heapq，sum……



bad code
```python
def find(seq, target):
    found= False
    for i, value in enumerate(seq):
        if value == target:
            found = True
            break
    if not found:
        return -1
    return i
    
```

good code
```python
def find(seq, target):
    for i, value in enumerate(seq):
        if value == target:
            break
    else:
        return -1
    return i

```

bad code
```python
for k in d:
    print k,'--->',d[k]
# 产生一个很大的列表
for k, vin d.items():
    print k, '--->', v
```

good code
```python
for k,v in d.iteritems():
    print k,'--->',v
```
iteritems()更好是因为它返回了一个迭代器。

注意：Python 3已经没有iteritems()了，items()的行为和iteritems()很接近。


bad code
```python
colors = ['red', 'green', 'red', 'blue', 'green', 'red']

# 简单，基本的计数方法。适合初学者起步时学习。
d = {}
for color in colors:
    if color not in d:
        d[color] = 0
    d[color] += 1

# {'blue': 1, 'green': 2, 'red': 3}
```

good code
```python
d = {}
for color in colors:
    d[color] = d.get(color, 0) + 1

# 稍微潮点的方法，但有些坑需要注意，适合熟练的老手。
d = defaultdict(int)
for color in colors:
    d[color] += 1
```

bad code
```python
names = ['raymond', 'rachel', 'matthew', 'roger',
         'betty', 'melissa', 'judith', 'charlie']

s = names[0]
for name in names[1:]:
    s += ', ' + name
print s
```

good code
```python
print ', '.join(names)
```

bad code
```python
names = ['raymond', 'rachel', 'matthew', 'roger',
         'betty', 'melissa', 'judith', 'charlie']

del names[0]
# 下面的代码标志着你用错了数据结构
names.pop(0)
names.insert(0, 'mark')
```
good code
```python
names = deque(['raymond', 'rachel', 'matthew', 'roger',
               'betty', 'melissa', 'judith', 'charlie'])

# 用deque更有效率
del names[0]
names.popleft()
names.appendleft('mark')
```

使用装饰器分离出管理逻辑
bad code
```python
# 混着业务和管理逻辑，无法重用
def web_lookup(url, saved={}):
    if url in saved:
        return saved[url]
    page = urllib.urlopen(url).read()
    saved[url] = page
    return page
```
good code
```python
@cache
def web_lookup(url):
    return urllib.urlopen(url).read()
```

bad code
```python
f = open('data.txt')
try:
    data = f.read()
finally:
    f.close()
```

good code
```python
with open('data.txt') as f:
    data = f.read()
```

bad code
```python
# 创建锁
lock = threading.Lock()

# 使用锁的老方法
lock.acquire()
try:
    print 'Critical section 1'
    print 'Critical section 2'
finally:
    lock.release()
```
good code
```python
# 使用锁的新方法
with lock:
    print 'Critical section 1'
    print 'Critical section 2'
```

bad code
```python
try:
    os.remove('somefile.tmp')
except OSError:
    pass
```
good code
```python
with ignored(OSError):
    os.remove('somefile.tmp')
````
ignored是Python 3.4加入的, 文档。

bad code
```python
# 临时把标准输出重定向到一个文件，然后再恢复正常
with open('help.txt', 'w') as f:
    oldstdout = sys.stdout
    sys.stdout = f
    try:
        help(pow)
    finally:
        sys.stdout = oldstdout
```
good code
```python
with open('help.txt', 'w') as f:
    with redirect_stdout(f):
        help(pow)
```


### 简洁的单句表达

- 两个冲突的原则：
    1. 一行不要有太多逻辑
    2. 不要把单一的想法拆分成多个部分

- Raymond的原则：
    1. 一行代码的逻辑等价于一句自然语言

bad code
```python
result = []
for i in range(10):
s = i ** 2
    result.append(s)
print sum(result)
```
good code
```python
print sum(i**2 for i in xrange(10))
```
第一种方法说的是你在做什么，第二种方法说的是你想要什么。

-----


Want to see something else added? <a href="https://github.com/wangliyao518/blog/issues/new">Open an issue.</a>
